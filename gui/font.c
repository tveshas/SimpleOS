// External function
extern void put_pixel(int x, int y, unsigned char color);

// Simple 8x8 bitmap font - complete working version
unsigned char font_8x8[256][8] = {
    // Initialize all to zero first
    [0] = {0,0,0,0,0,0,0,0},
    
    // Space (32)
    [32] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
    
    // A (65)
    [65] = {0x18, 0x3C, 0x66, 0x7E, 0x66, 0x66, 0x66, 0x00},
    // B (66)  
    [66] = {0x7C, 0x66, 0x66, 0x7C, 0x66, 0x66, 0x7C, 0x00},
    // C (67)
    [67] = {0x3C, 0x66, 0x60, 0x60, 0x60, 0x66, 0x3C, 0x00},
    // D (68)
    [68] = {0x78, 0x6C, 0x66, 0x66, 0x66, 0x6C, 0x78, 0x00},
    // E (69)
    [69] = {0x7E, 0x60, 0x60, 0x78, 0x60, 0x60, 0x7E, 0x00},
    // F (70)
    [70] = {0x7E, 0x60, 0x60, 0x78, 0x60, 0x60, 0x60, 0x00},
    // G (71)
    [71] = {0x3C, 0x66, 0x60, 0x6E, 0x66, 0x66, 0x3C, 0x00},
    // H (72)
    [72] = {0x66, 0x66, 0x66, 0x7E, 0x66, 0x66, 0x66, 0x00},
    // I (73)
    [73] = {0x3C, 0x18, 0x18, 0x18, 0x18, 0x18, 0x3C, 0x00},
    // L (76)
    [76] = {0x60, 0x60, 0x60, 0x60, 0x60, 0x60, 0x7E, 0x00},
    // M (77)
    [77] = {0x63, 0x77, 0x7F, 0x6B, 0x63, 0x63, 0x63, 0x00},
    // N (78) 
    [78] = {0x66, 0x76, 0x7E, 0x7E, 0x6E, 0x66, 0x66, 0x00},
    // O (79)
    [79] = {0x3C, 0x66, 0x66, 0x66, 0x66, 0x66, 0x3C, 0x00},
    // R (82)
    [82] = {0x7C, 0x66, 0x66, 0x7C, 0x78, 0x6C, 0x66, 0x00},
    // S (83)
    [83] = {0x3C, 0x66, 0x60, 0x3C, 0x06, 0x66, 0x3C, 0x00},
    // T (84)
    [84] = {0x7E, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x00},
    // U (85)
    [85] = {0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x3C, 0x00},
    // W (87)
    [87] = {0x66, 0x66, 0x66, 0x66, 0x66, 0x7E, 0x18, 0x00},
};

void draw_char(int x, int y, char c, unsigned char color) {
    unsigned char ch = (unsigned char)c;
    
    for(int row = 0; row < 8; row++) {
        unsigned char line = font_8x8[ch][row];
        for(int col = 0; col < 8; col++) {
            if(line & (0x80 >> col)) {  // Test bit from left to right
                put_pixel(x + col, y + row, color);
            }
        }
    }
}

void draw_text(int x, int y, char* text, unsigned char color) {
    int offset = 0;
    while(*text) {
        draw_char(x + offset * 8, y, *text, color);
        text++;
        offset++;
    }
}
